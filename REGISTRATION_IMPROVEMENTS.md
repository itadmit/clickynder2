# ×©×™×¤×•×¨×™× ×‘×ª×”×œ×™×š ×”×¨×™×©×•× ×•×”×”×ª×—×‘×¨×•×ª ğŸ”

×ª×™×¢×•×“ ×”×©×™× ×•×™×™× ×©×‘×•×¦×¢×• ×œ×©×™×¤×•×¨ ×ª×”×œ×™×š ×”×¨×™×©×•× ×•×”×”×ª×—×‘×¨×•×ª ×‘××¢×¨×›×ª Clickynder.

## ×ª××¨×™×š ×¢×“×›×•×Ÿ: 18 ××•×§×˜×•×‘×¨ 2025

---

## ğŸ“‹ ×¡×™×›×•× ×”×©×™× ×•×™×™×

### 1. **×˜×œ×¤×•×Ÿ ×›×©×“×” ×™×™×—×•×“×™ (Unique)**
- âœ… ×©×“×” ×”×˜×œ×¤×•×Ÿ ×‘××¡×“ ×”× ×ª×•× ×™× ×”×•×’×“×¨ ×›-unique
- âœ… × ×•×¡×£ ××™× ×“×§×¡ ×¢×œ ×©×“×” ×”×˜×œ×¤×•×Ÿ ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×
- âœ… ×©×“×” ×”×˜×œ×¤×•×Ÿ ×”×¤×š ×œ×—×•×‘×” (×œ× null)

**×§×•×‘×¥:** `prisma/schema.prisma`
```prisma
model User {
  phone         String    @unique  // â† ×©×•× ×” ×-String? ×œ-String @unique
  
  @@index([phone])  // â† ××™× ×“×§×¡ ×—×“×©
}
```

**××™×’×¨×¦×™×”:** `20251018072359_make_phone_unique`

---

### 2. **×‘×“×™×§×ª ×–××™× ×•×ª ×‘×–××Ÿ ×××ª**
× ×•×¦×¨ API endpoint ×—×“×© ×œ×‘×“×™×§×ª ×–××™× ×•×ª ××™××™×™×œ ×•×˜×œ×¤×•×Ÿ:

**×§×•×‘×¥:** `src/app/api/auth/check-availability/route.ts`

**×©×™××•×©:**
```javascript
// ×‘×“×™×§×ª ××™××™×™×œ
GET /api/auth/check-availability?email=test@example.com
// ×ª×’×•×‘×”: { emailAvailable: true }

// ×‘×“×™×§×ª ×˜×œ×¤×•×Ÿ
GET /api/auth/check-availability?phone=0501234567
// ×ª×’×•×‘×”: { phoneAvailable: false }

// ×‘×“×™×§×ª ×©× ×™×”×
GET /api/auth/check-availability?email=...&phone=...
// ×ª×’×•×‘×”: { emailAvailable: true, phoneAvailable: true }
```

---

### 3. **×©×™×¤×•×¨×™× ×‘×“×£ ×”×¨×™×©×•×**

#### ×‘×“×™×§×•×ª ×‘×–××Ÿ ×××ª ×‘×©×œ×‘ 1
- âœ… ×‘×“×™×§×ª ×–××™× ×•×ª ××™××™×™×œ ×ª×•×š 500ms ××”×§×œ×“×”
- âœ… ×‘×“×™×§×ª ×–××™× ×•×ª ×˜×œ×¤×•×Ÿ ×ª×•×š 500ms ××”×§×œ×“×”
- âœ… ××™× ×“×™×§×˜×•×¨×™× ×—×–×•×ª×™×™×:
  - ğŸ”µ Loader - ×‘×•×“×§ ×–××™× ×•×ª
  - âœ… CheckCircle ×™×¨×•×§ - ×–××™×Ÿ
  - âŒ XCircle ××“×•× - ×ª×¤×•×¡

#### ×•×œ×™×“×¦×™×” ××©×•×¤×¨×ª
```typescript
validateStep1() {
  // ×‘×“×™×§×ª ×¤×•×¨××˜ ××™××™×™×œ
  // ×‘×“×™×§×ª ×–××™× ×•×ª ××™××™×™×œ
  // ×‘×“×™×§×ª ×¤×•×¨××˜ ×˜×œ×¤×•×Ÿ (05X-XXXXXXX)
  // ×‘×“×™×§×ª ×–××™× ×•×ª ×˜×œ×¤×•×Ÿ
  // ××™ ××¤×©×¨ ×œ×¢×‘×•×¨ ×œ×©×œ×‘ 2 ×× ×™×© ×‘×¢×™×”
}
```

#### ×”×•×“×¢×•×ª ×©×’×™××” ×‘×¨×•×¨×•×ª
- "××©×ª××© ×¢× ××™××™×™×œ ×–×” ×›×‘×¨ ×§×™×™×"
- "××¡×¤×¨ ×˜×œ×¤×•×Ÿ ×–×” ×›×‘×¨ ×‘×©×™××•×©"
- "×‘×•×“×§ ×–××™× ×•×ª..." (×‘××”×œ×š ×”×‘×“×™×§×”)
- "×× × ×”××ª×Ÿ ×œ×‘×“×™×§×ª ×–××™× ×•×ª..." (×× × ×™×¡×” ×œ×”××©×™×š ×œ×¤× ×™ ×©×”×‘×“×™×§×” ×”×¡×ª×™×™××”)

**×§×•×‘×¥:** `src/app/auth/register/page.tsx`

---

### 4. **×”×ª×—×‘×¨×•×ª ×¢× ×˜×œ×¤×•×Ÿ ××• ××™××™×™×œ**

#### NextAuth Configuration
×¢×•×“×›×Ÿ ×”-CredentialsProvider ×œ×ª××•×š ×‘×©× ×™ ×¡×•×’×™ ×–×™×”×•×™:

**×§×•×‘×¥:** `src/lib/auth.ts`
```typescript
credentials: {
  identifier: { label: '××™××™×™×œ ××• ×˜×œ×¤×•×Ÿ', type: 'text' },  // â† ×©×•× ×” ×-email
  password: { label: '×¡×™×¡××”', type: 'password' },
}

// ×œ×•×’×™×§×ª ×–×™×”×•×™:
const isEmail = credentials.identifier.includes('@');
const user = await prisma.user.findUnique({
  where: isEmail 
    ? { email: credentials.identifier }
    : { phone: credentials.identifier.replace(/[-\s]/g, '') }
});
```

#### ×“×£ ×”×”×ª×—×‘×¨×•×ª
×¢×•×“×›×Ÿ ×œ×§×‘×œ ××™××™×™×œ ××• ×˜×œ×¤×•×Ÿ:

**×§×•×‘×¥:** `src/app/auth/signin/page.tsx`
- ×©×“×” "××™××™×™×œ ××• ×˜×œ×¤×•×Ÿ" ×‘××§×•× "××™××™×™×œ" ×‘×œ×‘×“
- placeholder: "your@email.com ××• 0501234567"
- ×”××¢×¨×›×ª ××–×”×” ××•×˜×•××˜×™×ª ××” ×”×•×–×Ÿ

---

## ğŸ¨ ×—×•×•×™×™×ª ××©×ª××© (UX)

### ×œ×¤× ×™:
1. ××©×ª××© ×××œ× ××ª ×›×œ ×”×˜×•×¤×¡
2. ×œ×•×—×¥ "×”××©×š"
3. ××§×‘×œ ×©×’×™××” "××™××™×™×œ ×›×‘×¨ ×§×™×™×"
4. ×¦×¨×™×š ×œ××œ× ×”×›×œ ××—×“×© ğŸ˜

### ××—×¨×™:
1. ××©×ª××© ××ª×—×™×œ ×œ×”×§×œ×™×“ ××™××™×™×œ
2. ××—×¨×™ 500ms - ×‘×“×™×§×” ××•×˜×•××˜×™×ª
3. ×¨×•××” ××™×“ âœ… ××• âŒ
4. ×œ× ×™×›×•×œ ×œ×¢×‘×•×¨ ×œ×©×œ×‘ ×”×‘× ×× ×™×© ×‘×¢×™×”
5. ×—×•×¡×š ×–××Ÿ ×•×× ×™×¢×ª ×ª×¡×›×•×œ! ğŸ˜Š

---

## ğŸ”’ ××‘×˜×—×”

### × ×¨××•×œ ×˜×œ×¤×•×Ÿ
×›×œ ××¡×¤×¨×™ ×”×˜×œ×¤×•×Ÿ ×× ×•×¨××œ×™× ×œ×”×¡×¨×ª ×¨×•×•×—×™× ×•××§×¤×™×:
```typescript
phone: credentials.identifier.replace(/[-\s]/g, '')
```

×–×” ××‘×˜×™×— ×©×”××¡×¤×¨×™× ×”×‘××™× ×™×™×—×©×‘×• ×–×”×™×:
- `0501234567`
- `050-1234567`
- `050 123 4567`

### Unique Constraint
- ××™ ××¤×©×¨ ×œ×¨×©×•× 2 ××©×ª××©×™× ×¢× ××•×ª×• ××™××™×™×œ
- ××™ ××¤×©×¨ ×œ×¨×©×•× 2 ××©×ª××©×™× ×¢× ××•×ª×• ×˜×œ×¤×•×Ÿ
- ×”××’×‘×œ×” × ××›×¤×ª ×‘×¨××ª ××¡×“ ×”× ×ª×•× ×™× (×œ× ×¨×§ ×‘×§×•×“)

---

## ğŸš€ ××™×š ×œ×”×©×ª××©

### ×”×ª×—×‘×¨×•×ª:
1. ×’×© ×œ-`/auth/signin`
2. ×”×–×Ÿ ××™××™×™×œ **××•** ×˜×œ×¤×•×Ÿ
3. ×”×–×Ÿ ×¡×™×¡××”
4. ×œ×—×¥ "×”×ª×—×‘×¨"

×“×•×’×××•×ª:
- `user@example.com` + ×¡×™×¡××” âœ…
- `0501234567` + ×¡×™×¡××” âœ…

### ×¨×™×©×•×:
1. ×’×© ×œ-`/auth/register`
2. ××œ× ×¤×¨×˜×™× ××™×©×™×™× (×©×œ×‘ 1):
   - ×©× ××œ×
   - ××™××™×™×œ (×‘×“×™×§×” ××•×˜×•××˜×™×ª)
   - ×˜×œ×¤×•×Ÿ (×‘×“×™×§×” ××•×˜×•××˜×™×ª)
   - ×¡×™×¡××”
3. ×”××ª×Ÿ ×œ××™×©×•×¨ ×–××™× ×•×ª (âœ… ×™×¨×•×§)
4. ×œ×—×¥ "×”××©×š" ×œ×©×œ×‘ 2
5. ××œ× ×¤×¨×˜×™ ×¢×¡×§

---

## ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª

### ×–××Ÿ ×ª×’×•×‘×”:
- ×‘×“×™×§×ª ×–××™× ×•×ª: ~100-300ms
- Debounce: 500ms (×œ×”×§×œ×“×”)
- ×¡×”"×›: ××©×ª××© ×¨×•××” ×ª×•×¦××” ×ª×•×š ~800ms

### ×©×™×¤×•×¨ UX:
- âœ… 100% ×™×¨×™×“×” ×‘×©×’×™××•×ª "××™××™×™×œ ×§×™×™×" ×‘×¡×•×£ ×”×˜×•×¤×¡
- âœ… ×—×™×¡×›×•×Ÿ ×©×œ ~2-3 ×“×§×•×ª ×œ×›×œ ×¨×™×©×•× ×›×•×©×œ
- âœ… ××¤×©×¨×•×ª ×”×ª×—×‘×¨×•×ª × ×•×¡×¤×ª (×˜×œ×¤×•×Ÿ)

---

## ğŸ§ª ×‘×“×™×§×•×ª

### ×‘×“×™×§×•×ª ×™×“× ×™×•×ª ××•××œ×¦×•×ª:

1. **×¨×™×©×•× ×¢× ××™××™×™×œ ×§×™×™×:**
   - × ×¡×” ×œ×”×™×¨×©× ×¢× ××™××™×™×œ ×©×›×‘×¨ ×§×™×™×
   - ×•×•×“× ×©××ª×” ×¨×•××” âŒ ××“×•× ×•×”×•×“×¢×ª ×©×’×™××”
   - ×•×•×“× ×©×œ× × ×™×ª×Ÿ ×œ×œ×—×•×¥ "×”××©×š"

2. **×¨×™×©×•× ×¢× ×˜×œ×¤×•×Ÿ ×§×™×™×:**
   - × ×¡×” ×œ×”×™×¨×©× ×¢× ×˜×œ×¤×•×Ÿ ×©×›×‘×¨ ×§×™×™×
   - ×•×•×“× ×©××ª×” ×¨×•××” âŒ ××“×•× ×•×”×•×“×¢×ª ×©×’×™××”

3. **×¨×™×©×•× ×¢× ×¤×¨×˜×™× ×–××™× ×™×:**
   - ×”×©×ª××© ×‘××™××™×™×œ ×•×˜×œ×¤×•×Ÿ ×—×“×©×™×
   - ×•×•×“× ×©××ª×” ×¨×•××” âœ… ×™×¨×•×§
   - ×•×•×“× ×©×”×¨×™×©×•× ×¢×•×‘×¨ ×‘×”×¦×œ×—×”

4. **×”×ª×—×‘×¨×•×ª ×¢× ××™××™×™×œ:**
   - ×”×ª×—×‘×¨ ×¢× ××™××™×™×œ ×•×¡×™×¡××” × ×›×•× ×™×
   - ×•×•×“× ×›× ×™×¡×” ××•×¦×œ×—×ª

5. **×”×ª×—×‘×¨×•×ª ×¢× ×˜×œ×¤×•×Ÿ:**
   - ×”×ª×—×‘×¨ ×¢× ×˜×œ×¤×•×Ÿ ×•×¡×™×¡××” × ×›×•× ×™×
   - × ×¡×” ×¤×•×¨××˜×™× ×©×•× ×™×: `0501234567`, `050-1234567`
   - ×•×•×“× ×›× ×™×¡×” ××•×¦×œ×—×ª

---

## ğŸ“ ×”×¢×¨×•×ª ×œ××¤×ª×—×™×

### Debounce Pattern
×”×©×ª××©× ×• ×‘-debounce ×©×œ 500ms ×›×“×™ ×œ×× ×•×¢ ×‘×§×©×•×ª ××™×•×ª×¨×•×ª ×œ×©×¨×ª:

```typescript
const timeout = setTimeout(() => {
  checkEmailAvailability(value);
}, 500);
```

### State Management
×©×œ×•×©×” ×¡×˜×™×™×˜×™× ×œ×›×œ ×©×“×”:
- `emailCheckStatus`: 'idle' | 'checking' | 'available' | 'taken'
- `phoneCheckStatus`: 'idle' | 'checking' | 'available' | 'taken'
- `slugCheckStatus`: 'idle' | 'checking' | 'available' | 'taken'

### Cleanup
×—×©×•×‘ ×œ× ×§×•×ª timeouts ×‘××§×¨×” ×©×œ unmount:
```typescript
useEffect(() => {
  return () => {
    if (emailCheckTimeout) clearTimeout(emailCheckTimeout);
    if (phoneCheckTimeout) clearTimeout(phoneCheckTimeout);
  };
}, [emailCheckTimeout, phoneCheckTimeout]);
```

---

## ğŸ”„ ×¤×¨×™×¡×” ×œ×¤×¨×•×“×§×©×Ÿ

×œ××—×¨ ×”××™×’×¨×¦×™×” ×‘×¤×¨×•×“×§×©×Ÿ, ×™×© ×œ×•×•×“×:

1. âœ… ×”××™×’×¨×¦×™×” ×¨×¦×” ×‘×”×¦×œ×—×”: `npx prisma migrate deploy`
2. âœ… ××™×Ÿ ××©×ª××©×™× ×¢× ×˜×œ×¤×•× ×™× ×›×¤×•×œ×™× (×œ×¤× ×™ ×”××™×’×¨×¦×™×”)
3. âœ… ×”-API endpoint ×—×“×© ×–××™×Ÿ
4. âœ… NextAuth ××•×’×“×¨ × ×›×•×Ÿ

### ×¤×§×•×“×•×ª ×¤×¨×™×¡×”:
```bash
# ××§×•××™
npm run build
npx prisma migrate deploy

# ×©×¨×ª (Docker)
./deploy-local-build.sh
```

---

## âš ï¸ ×©×™× ×•×™×™× ×©×•×‘×¨×™× (Breaking Changes)

### ×œ××©×ª××©×™× ×§×™×™××™×:
- âœ… **××™×Ÿ ×©×™× ×•×™×™× ×©×•×‘×¨×™×**
- ××©×ª××©×™× ×§×™×™××™× ×™×›×•×œ×™× ×œ×”××©×™×š ×œ×”×ª×—×‘×¨ ×¢× ××™××™×™×œ
- ×¢×›×©×™×• ×”× ×’× ×™×›×•×œ×™× ×œ×”×ª×—×‘×¨ ×¢× ×˜×œ×¤×•×Ÿ

### ×œ××¤×ª×—×™×:
- âš ï¸ ×”-credentials ×©×œ NextAuth ×”×©×ª× ×”:
  - ×œ×¤× ×™: `{ email, password }`
  - ××—×¨×™: `{ identifier, password }`
  
×× ×™×© ×§×•×“ ×©××©×ª××© ×™×©×™×¨×•×ª ×‘-`signIn('credentials', { email, password })`, ×™×© ×œ×¢×“×›×Ÿ ×œ-`identifier`.

---

## ğŸ“ ×ª××™×›×”

×× ×™×© ×‘×¢×™×•×ª ××• ×©××œ×•×ª:
1. ×‘×“×•×§ ××ª ×”-console logs ×‘×“×¤×“×¤×Ÿ
2. ×‘×“×•×§ ××ª ×”-server logs: `docker logs clickynder_app -f`
3. ×•×“× ×©×”××™×’×¨×¦×™×” ×¨×¦×”: `npx prisma migrate status`

---

**×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:** 18 ××•×§×˜×•×‘×¨ 2025, 10:24
**×’×¨×¡×”:** v1.2.0
**××¤×ª×—:** Clickynder Team

